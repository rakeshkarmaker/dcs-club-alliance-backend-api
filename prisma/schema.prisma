generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  // url= env("DATABASE_URL")
}

enum UserType {
  admin
  dcs
  alumni
  mentor
  other
}

enum AccountStatus {
  active
  disabled
  unverified
}

enum MembershipRole {
  precedent
  moderator
  member
  unassigned
}

enum MembershipStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum FormResponseStatus {
  pending
  verified
  rejected
}

// Prisma Schema language is  a language that prisma uses to define the database schema.
// It is used to define models, enums, and relationships between them.
//What we have here::
// 1. Models: These are the main entities in the database.
// 2. Enums: These are used to define a set of predefined values for a field in a model.
// 3. Relationships: These define how models are related to each other.

// prisma Schema components: Datasource, Generator, Models

model UserAuth {
  id            Int           @id @default(autoincrement())
  email         String        @unique
  password      String        @map("password")
  accountStatus AccountStatus @default(unverified) @map("account_status")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  user   User? @relation(fields: [userId], references: [id])
  userId Int?  @unique
}

model LoginActivity {
  id        Int      @id @default(autoincrement())
  userId    Int
  loggedIn  DateTime @default(now())
  ipAddress String?
  location  String?
  device    String?
  user      User     @relation(fields: [userId], references: [id])
}

model User {
  id           Int       @id @default(autoincrement())
  firstName    String    @map("first_name")
  lastName     String    @map("last_name")
  dateOfBirth  DateTime? @map("date_of_birth")
  phoneNumber  String?   @map("phone_number")
  profileImage String?   @map("profile_image")
  userType     UserType  @default(other) @map("user_type")

  // New relationships from updated ER diagram
  userAuth    UserAuth?
  studentInfo StudentInfo?

  // Existing relationships
  loginActivities LoginActivity[]
  memberships     Membership[]
  notices         Notice[]
  activities      Activity[]
  certificates    Certificate[]
  formResponses   FormResponse[]
  blogs           Blog[]
  comments        Comment[]
  // schools       School[] // Schools created by this user
}

model StudentInfo {
  id           Int      @id @default(autoincrement())
  schoolName   String?  @map("school_name")
  rollNumber   String   @map("roll_number")
  className    String   @map("class_name")
  classSection String   @map("class_section")
  idCardPic    String?  @map("id_card_pic")
  createdAt    DateTime @default(now()) @map("created_at")

  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique

  // school   School @relation(fields: [schoolId], references: [id])
  // schoolId Int
}

// model School {
//   id        Int      @id @default(autoincrement())
//   name      String
//   address   String
//   email     String
//   phone     String
//   logo      String?
//   website   String?
//   isActive  Boolean  @default(true) @map("is_active")
//   createdAt DateTime @default(now()) @map("created_at")

//   user   User @relation(fields: [userId], references: [id])
//   userId Int

//   students StudentInfo[]
// }

model Membership {
  id       Int              @id @default(autoincrement())
  userId   Int              @map("user_id")
  clubId   Int              @map("club_id")
  role     MembershipRole   @default(unassigned)
  status   MembershipStatus @default(PENDING)
  joinedAt DateTime         @default(now()) @map("joined_at")

  user User @relation(fields: [userId], references: [id])
  club Club @relation(fields: [clubId], references: [id])

  @@unique([userId, clubId])
}

// ... (Club, Notice, Activity, Event, Certificate, EventCategory, Form, FormResponse, Blog, Comment models remain the same as previous)

model Club {
  id          Int      @id @default(autoincrement())
  name        String
  slug        String   @unique
  mission     String
  vision      String
  description String
  logo        String?
  banner      String?
  mentorId    Int?     @map("mentor_id")
  createdAt   DateTime @default(now()) @map("created_at")

  memberships Membership[]
  notices     Notice[]
  activities  Activity[]
  events      Event[]
  blogs       Blog[]
}

model Notice {
  id        Int      @id @default(autoincrement())
  clubId    Int      @map("club_id")
  userId    Int      @map("user_id")
  title     String
  content   String
  createdAt DateTime @default(now()) @map("created_at")

  club Club @relation(fields: [clubId], references: [id])
  user User @relation(fields: [userId], references: [id])
}

model Activity {
  id          Int      @id @default(autoincrement())
  clubId      Int      @map("club_id")
  userId      Int      @map("user_id")
  title       String
  description String
  images      String[]
  createdAt   DateTime @default(now()) @map("created_at")

  club Club @relation(fields: [clubId], references: [id])
  user User @relation(fields: [userId], references: [id])
}

model Event {
  id          Int      @id @default(autoincrement())
  clubId      Int      @map("club_id")
  title       String
  slug        String   @unique
  description String
  startTime   DateTime @map("start_time")
  endTime     DateTime @map("end_time")
  venue       String
  fee         Float
  formLink    String?  @map("form_link")
  isFree    Boolean  @default(true) @map("is_free")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")

  certificates    Certificate[]
  eventCategories EventCategory[]
  forms           Form[]
  club            Club            @relation(fields: [clubId], references: [id])
}

model Certificate {
  id       Int      @id @default(autoincrement())
  userId   Int      @map("user_id")
  eventId  Int      @map("event_id")
  pdfLink  String   @map("pdf_link")
  qrCode   String   @map("qr_code")
  issuedAt DateTime @default(now()) @map("issued_at")

  user  User  @relation(fields: [userId], references: [id])
  event Event @relation(fields: [eventId], references: [id])
}

model EventCategory {
  id          Int      @id @default(autoincrement())
  eventId     Int      @map("event_id")
  category    String
  description String
  createdAt   DateTime @default(now()) @map("created_at")

  event Event  @relation(fields: [eventId], references: [id])
  forms Form[]
}

model Form {
  id         Int      @id @default(autoincrement())
  eventId    Int      @map("event_id")
  categoryId Int      @map("category_id")
  title      String
  schemaJson Json     @map("schema_json")
  createdAt  DateTime @default(now()) @map("created_at")

  event     Event          @relation(fields: [eventId], references: [id])
  category  EventCategory  @relation(fields: [categoryId], references: [id])
  responses FormResponse[]
}

model FormResponse {
  id           Int                @id @default(autoincrement())
  formId       Int                @map("form_id")
  userId       Int                @map("user_id")
  responseJson Json               @map("response_json")
  status       FormResponseStatus @default(pending)
  submittedAt  DateTime           @default(now()) @map("submitted_at")

  form Form @relation(fields: [formId], references: [id])
  user User @relation(fields: [userId], references: [id])
}

model Blog {
  id          Int       @id @default(autoincrement())
  userId      Int       @map("user_id")
  clubId      Int       @map("club_id")
  title       String
  content     String
  slug        String    @unique
  publishedAt DateTime? @map("published_at")
  image       String[]
  likes       Int       @default(0)

  user     User      @relation(fields: [userId], references: [id])
  club     Club      @relation(fields: [clubId], references: [id])
  comments Comment[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  blogId    Int      @map("blog_id")
  userId    Int      @map("user_id")
  text      String
  createdAt DateTime @default(now()) @map("created_at")

  blog Blog @relation(fields: [blogId], references: [id])
  user User @relation(fields: [userId], references: [id])
}
